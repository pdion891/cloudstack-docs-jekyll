<!doctype html>
<!--[if lt IE 7 ]><html itemscope itemtype="http://schema.org/Organization" id="ie6" class="ie ie-old" lang="en-US"><![endif]-->
<!--[if IE 7 ]>   <html itemscope itemtype="http://schema.org/Organization" id="ie7" class="ie ie-old" lang="en-US"><![endif]-->
<!--[if IE 8 ]>   <html itemscope itemtype="http://schema.org/Organization" id="ie8" class="ie ie-old" lang="en-US"><![endif]-->
<!--[if IE 9 ]>   <html itemscope itemtype="http://schema.org/Organization" id="ie9" class="ie" lang="en-US"><![endif]-->
<!--[if gt IE 9]><!-->
<html itemscope itemtype="http://schema.org/Organization" lang="en-US"><!--<![endif]-->
<head>

    <!-- Meta -->
    <meta charset="utf-8">
 
    <title>Apache Cloudstack Documentation</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="Apache Cloudstack Documentation" href="http://localhost:4000/feed.xml">
    <link rel="alternate" type="application/atom+xml" title="Apache Cloudstack Documentation" href="http://localhost:4000/atom.xml">

    <!-- Favicons -->
    <link rel="shortcut icon" sizes="16x16 24x24 32x32 48x48 64x64 96x96" href="http://localhost:4000/favicon.ico">
    <link rel="apple-touch-icon" sizes="57x57" href="http://localhost:4000/img/favicons/favicon-57.png">
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="http://localhost:4000/img/favicons/favicon-57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="http://localhost:4000/img/favicons/favicon-60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/img/favicons/favicon-72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="http://localhost:4000/img/favicons/favicon-76.png">
    <link rel="apple-touch-icon" sizes="96x96" href="http://localhost:4000/img/favicons/favicon-96.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/img/favicons/favicon-114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="http://localhost:4000/img/favicons/favicon-120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/img/favicons/favicon-144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="http://localhost:4000/img/favicons/favicon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="http://localhost:4000/img/favicons/favicon-180.png">
    <link rel="apple-touch-icon" sizes="192x192" href="http://localhost:4000/img/favicons/favicon-192.png">
    <meta name="application-name" content="Apache Cloudstack Documentation">
    <meta name="msapplication-TileImage" content="/img/favicons/favicon-144.png">
    <meta name="msapplication-TileColor" content="#ffffff">

    <!-- Fonts -->
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto+Condensed:300,300italic,400,400italic,700,700italic|Oswald:300,400,700">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">

    <!-- Styles -->
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/sidebar.css">
    <link rel="stylesheet" href="/css/toc.css">
    <!--[if lt IE 9]>
        <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="/js/respond.min.js"></script>
    <![endif]-->

</head>
<body class="">

   <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Apache Cloudstack Documentation</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav navbar-right">
                    
                        <li>
                            <a href="/">Blog</a>
                        </li>
                    
                        <li>
                            <a href="/about">About</a>
                        </li>
                    
                        <li>
                            <a href="/test">test</a>
                        </li>
                    
                        <li>
                            <a href="/quick">Quick</a>
                        </li>
                    
                </ul>
            </div>
        </div>
    </nav>

  
<div id="wrapper" class="active">
      
      <!-- Sidebar -->
      <div id="sidebar-wrapper">
      <ul id="sidebar_menu" class="sidebar-nav">
           <li class="sidebar-brand"><a id="menu-toggle" href="#">Guides<span id="main_icon" class="fa fa-bars"></span></a></li>
      </ul>
        <ul class="sidebar-nav" id="sidebar">    
          
            <li>
              <a href="/architecture">Architecture<span class="icone fa fa-cloud"></span>
              </a>
            </li>
          
            <li>
              <a href="/installation">Installation<span class="icone fa fa-book"></span>
              </a>
            </li>
          
            <li>
              <a href="/configuration">Configuration<span class="icone fa fa-cogs"></span>
              </a>
            </li>
          
            <li>
              <a href="/admin">Administration<span class="icone fa fa-user-plus"></span>
              </a>
            </li>
          
            <li>
              <a href="/user">User<span class="icone fa fa-user"></span>
              </a>
            </li>
           
        </ul>
      </div>
          
 



<ol class="breadcrumb">
<li><a href="/">Docs</a></li>




    
    
    
    
        
    
        
    
        
    
        
    
        
        
            <li >
                
                <a href="/installation/">installation</a>
            </li>
        
    
        
    
        
    
        
    
        
    
        
    

    
    
    
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

</ol>

 <!-- Page content -->

<div id="page-content-wrapper">
<!-- Keep all page content within the page-content inset div! -->

    <div class="title-group">
        <header>
            <h1>
                Quick Installation Guide
                <small>Using CentOS 6 and KVM</small>
            </h1>           
        </header>
    </div>
    <div class="row container">
        <div id="main" class="col-md-12">
            <div class="toc-side" id="renderIn"></div>
            <h1 id="overview">Overview</h1>

<h2 id="what-exactly-are-we-building">What exactly are we building?</h2>

<p>Infrastructure-as-a-Service (IaaS) clouds can be a complex thing to build, and 
by definition they have a plethora of options, which often lead to confusion 
for even experienced admins who are newcomers to building cloud platforms. The 
goal for this runbook is to provide a straightforward set of instructions to 
get you up and running with CloudStack with a minimum amount of trouble.</p>

<h2 id="high-level-overview-of-the-process">High level overview of the process</h2>

<p>This runbook will focus on building a CloudStack cloud using KVM on CentOS 
6.8 with NFS storage on a flat layer-2 network utilizing layer-3 network 
isolation (aka Security Groups), and doing it all on a single piece of 
hardware.</p>

<p>KVM, or Kernel-based Virtual Machine is a virtualization technology for the 
Linux kernel. KVM supports native virtualization atop processors with hardware 
virtualization extensions.</p>

<p>Security Groups act as distributed firewalls that control access to a group of 
virtual machines.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>To complete this runbook you’ll need the following items:</p>

<ul>
  <li>At least one computer which supports and has enabled hardware virtualization.</li>
  <li>The <a href="http://mirrors.kernel.org/centos/6/isos/x86_64/">CentOS 6.8 x86_64 minimal install CD</a></li>
  <li>A /24 network with the gateway being at xxx.xxx.xxx.1, no DHCP should be on 
 this network and none of the computers running CloudStack will have a 
 dynamic address. Again this is done for the sake of simplicity.</li>
</ul>

<h1 id="environment">Environment</h1>

<p>Before you begin , you need to prepare the environment before you install 
CloudStack. We will go over the steps to prepare now.</p>

<h2 id="operating-system">Operating System</h2>

<p>Using the CentOS 6.8 x86_64 minimal install ISO, you’ll need to install CentOS 6 
on your hardware. The defaults will generally be acceptable for this 
installation.</p>

<p>Once this installation is complete, you’ll want to connect to your freshly 
installed machine via SSH as the root user. Note that you should not allow 
root logins in a production environment, so be sure to turn off remote logins 
once you have finished the installation and configuration.</p>

<h2 id="configuring-the-network">Configuring the network</h2>

<p>By default the network will not come up on your hardware and you will need to 
configure it to work in your environment. Since we specified that there will 
be no DHCP server in this environment we will be manually configuring your 
network interface. We will assume, for the purposes of this exercise, that 
eth0 is the only network interface that will be connected and used.</p>

<p>Connecting via the console you should login as root. Check the file 
<code class="highlighter-rouge">/etc/sysconfig/network-scripts/ifcfg-eth0</code>, it will look like this by default:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="nv">DEVICE</span><span class="o">=</span><span class="s2">"eth0"</span>
  <span class="nv">HWADDR</span><span class="o">=</span><span class="s2">"52:54:00:B9:A6:C0"</span>
  <span class="nv">NM_CONTROLLED</span><span class="o">=</span><span class="s2">"yes"</span>
  <span class="nv">ONBOOT</span><span class="o">=</span><span class="s2">"no"</span></code></pre></figure>

<p>Unfortunately, this configuration will not permit you to connect to the 
network, and is also unsuitable for our purposes with CloudStack. We want to 
configure that file so that it specifies the IP address, netmask, etc., as 
shown in the following example:</p>

<div class="alert alert-info" role="alert">
   You should not use the Hardware Address (aka the MAC address) from our 
   example for your configuration. It is network interface specific, so you 
   should keep the address already provided in the HWADDR directive.
</div>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="nv">DEVICE</span><span class="o">=</span>eth0
   <span class="nv">HWADDR</span><span class="o">=</span>52:54:00:B9:A6:C0
   <span class="nv">NM_CONTROLLED</span><span class="o">=</span>no
   <span class="nv">ONBOOT</span><span class="o">=</span>yes
   <span class="nv">BOOTPROTO</span><span class="o">=</span>none
   <span class="nv">IPADDR</span><span class="o">=</span>172.16.10.2
   <span class="nv">NETMASK</span><span class="o">=</span>255.255.255.0
   <span class="nv">GATEWAY</span><span class="o">=</span>172.16.10.1
   <span class="nv">DNS1</span><span class="o">=</span>8.8.8.8
   <span class="nv">DNS2</span><span class="o">=</span>8.8.4.4</code></pre></figure>

<div class="alert alert-info" role="alert">
   IP Addressing - Throughout this document we are assuming that you will have 
   a /24 network for your CloudStack implementation. This can be any RFC 1918 
   network. However, we are assuming that you will match the machine address 
   that we are using. Thus we may use 172.16.10.2 and because you might be 
   using the 192.168.55.0/24 network you would use 192.168.55.2
</div>

<p>Now that we have the configuration files properly set up, we need to run a few 
commands to start up the network:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="c"># chkconfig network on</span>

   <span class="c"># service network start</span></code></pre></figure>

<h2 id="hostname">Hostname</h2>

<p>CloudStack requires that the hostname be properly set. If you used the default 
options in the installation, then your hostname is currently set to 
localhost.localdomain. To test this we will run:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="c"># hostname --fqdn</span></code></pre></figure>

<p>At this point it will likely return:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   localhost</code></pre></figure>

<p>To rectify this situation - we’ll set the hostname by editing the /etc/hosts 
file so that it follows a similar format to this example:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4
   ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6
   172.16.10.2 srvr1.cloud.priv</code></pre></figure>

<p>After you’ve modified that file, go ahead and restart the network using:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="c"># service network restart</span></code></pre></figure>

<p>Now recheck with the hostname –fqdn command and ensure that it returns a FQDN 
response</p>

<h2 id="selinux">SELinux</h2>

<p>At the moment, for CloudStack to work properly SELinux must be set to 
permissive. We want to both configure this for future boots and modify it in 
the current running system.</p>

<p>To configure SELinux to be permissive in the running system we need to run the 
following command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="c"># setenforce 0</span></code></pre></figure>

<p>To ensure that it remains in that state we need to configure the file 
<code class="highlighter-rouge">/etc/selinux/config</code> to reflect the permissive state, as shown in this example:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="c"># This file controls the state of SELinux on the system.</span>
   <span class="c"># SELINUX= can take one of these three values:</span>
   <span class="c"># enforcing - SELinux security policy is enforced.</span>
   <span class="c"># permissive - SELinux prints warnings instead of enforcing.</span>
   <span class="c"># disabled - No SELinux policy is loaded.</span>
   <span class="nv">SELINUX</span><span class="o">=</span>permissive
   <span class="c"># SELINUXTYPE= can take one of these two values:</span>
   <span class="c"># targeted - Targeted processes are protected,</span>
   <span class="c"># mls - Multi Level Security protection.</span>
   <span class="nv">SELINUXTYPE</span><span class="o">=</span>targeted</code></pre></figure>

<h2 id="ntp">NTP</h2>

<p>NTP configuration is a necessity for keeping all of the clocks in your cloud 
servers in sync. However, NTP is not installed by default. So we’ll install 
and and configure NTP at this stage. Installation is accomplished as follows:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="c"># yum -y install ntp</span></code></pre></figure>

<p>The actual default configuration is fine for our purposes, so we merely need 
to enable it and set it to start on boot as follows:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="c"># chkconfig ntpd on</span>
   <span class="c"># service ntpd start</span></code></pre></figure>

<h2 id="configuring-the-cloudstack-package-repository">Configuring the CloudStack Package Repository</h2>

<p>We need to configure the machine to use a CloudStack package repository.</p>

<div class="alert alert-info" role="alert">
   The Apache CloudStack official releases are source code. As such there are 
   no 'official' binaries available. The full installation guide describes how 
   to take the source release and generate RPMs and and yum repository. This 
   guide attempts to keep things as simple as possible, and thus we are using 
   one of the community-provided yum repositories.
</div>

<p>To add the CloudStack repository, create /etc/yum.repos.d/cloudstack.repo and 
insert the following information.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="o">[</span>cloudstack]
   <span class="nv">name</span><span class="o">=</span>cloudstack
   <span class="nv">baseurl</span><span class="o">=</span>http://cloudstack.apt-get.eu/centos/6/4.9/
   <span class="nv">enabled</span><span class="o">=</span>1
   <span class="nv">gpgcheck</span><span class="o">=</span>0</code></pre></figure>

<h2 id="nfs">NFS</h2>

<p>Our configuration is going to use NFS for both primary and secondary storage. 
We are going to go ahead and setup two NFS shares for those purposes. We’ll 
start out by installing nfs-utils.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="c"># yum -y install nfs-utils</span></code></pre></figure>

<p>We now need to configure NFS to serve up two different shares. This is handled 
comparatively easily in the /etc/exports file. You should ensure that it has 
the following content:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   /export/secondary <span class="k">*</span><span class="o">(</span>rw,async,no_root_squash,no_subtree_check<span class="o">)</span>
   /export/primary <span class="k">*</span><span class="o">(</span>rw,async,no_root_squash,no_subtree_check<span class="o">)</span></code></pre></figure>

<p>You will note that we specified two directories that don’t exist (yet) on the 
system. We’ll go ahead and create those directories and set permissions 
appropriately on them with the following commands:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="c"># mkdir -p /export/primary</span>
   <span class="c"># mkdir /export/secondary</span></code></pre></figure>

<p>CentOS 6.x releases use NFSv4 by default. NFSv4 requires that domain setting 
matches on all clients. In our case, the domain is cloud.priv, so ensure that 
the domain setting in /etc/idmapd.conf is uncommented and set as follows:
Domain = cloud.priv</p>

<p>Now you’ll need uncomment the configuration values in the file 
<code class="highlighter-rouge">/etc/sysconfig/nfs</code></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="nv">LOCKD_TCPPORT</span><span class="o">=</span>32803
   <span class="nv">LOCKD_UDPPORT</span><span class="o">=</span>32769
   <span class="nv">MOUNTD_PORT</span><span class="o">=</span>892
   <span class="nv">RQUOTAD_PORT</span><span class="o">=</span>875
   <span class="nv">STATD_PORT</span><span class="o">=</span>662
   <span class="nv">STATD_OUTGOING_PORT</span><span class="o">=</span>2020</code></pre></figure>

<p>Now we need to configure the firewall to permit incoming NFS connections. 
Edit the file <code class="highlighter-rouge">/etc/sysconfig/iptables</code></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   -A INPUT -s 172.16.10.0/24 -m state --state NEW -p udp --dport 111 -j ACCEPT
   -A INPUT -s 172.16.10.0/24 -m state --state NEW -p tcp --dport 111 -j ACCEPT
   -A INPUT -s 172.16.10.0/24 -m state --state NEW -p tcp --dport 2049 -j ACCEPT
   -A INPUT -s 172.16.10.0/24 -m state --state NEW -p tcp --dport 32803 -j ACCEPT
   -A INPUT -s 172.16.10.0/24 -m state --state NEW -p udp --dport 32769 -j ACCEPT
   -A INPUT -s 172.16.10.0/24 -m state --state NEW -p tcp --dport 892 -j ACCEPT
   -A INPUT -s 172.16.10.0/24 -m state --state NEW -p udp --dport 892 -j ACCEPT
   -A INPUT -s 172.16.10.0/24 -m state --state NEW -p tcp --dport 875 -j ACCEPT
   -A INPUT -s 172.16.10.0/24 -m state --state NEW -p udp --dport 875 -j ACCEPT
   -A INPUT -s 172.16.10.0/24 -m state --state NEW -p tcp --dport 662 -j ACCEPT
   -A INPUT -s 172.16.10.0/24 -m state --state NEW -p udp --dport 662 -j ACCEPT</code></pre></figure>

<p>Now you can restart the iptables service with the following command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="c"># service iptables restart</span></code></pre></figure>

<p>We now need to configure the nfs service to start on boot and actually start 
it on the host by executing the following commands:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="c"># service rpcbind start</span>
   <span class="c"># service nfs start</span>
   <span class="c"># chkconfig rpcbind on</span>
   <span class="c"># chkconfig nfs on</span></code></pre></figure>

<h1 id="management-server-installation">Management Server Installation</h1>

<p>We’re going to install the CloudStack management server and surrounding tools.</p>

<h2 id="database-installation-and-configuration">Database Installation and Configuration</h2>

<p>We’ll start with installing MySQL and configuring some options to ensure it 
runs well with CloudStack.</p>

<p>Install by running the following command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="c"># yum -y install mysql-server</span></code></pre></figure>

<p>With MySQL now installed we need to make a few configuration changes to 
<code class="highlighter-rouge">/etc/my.cnf</code>. Specifically we need to add the following options to the [mysqld] 
section:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="nv">innodb_rollback_on_timeout</span><span class="o">=</span>1
   <span class="nv">innodb_lock_wait_timeout</span><span class="o">=</span>600
   <span class="nv">max_connections</span><span class="o">=</span>350
   log-bin<span class="o">=</span>mysql-bin
   binlog-format <span class="o">=</span> <span class="s1">'ROW'</span> </code></pre></figure>

<p>Now that MySQL is properly configured we can start it and configure it to 
start on boot as follows:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="c"># service mysqld start</span>
   <span class="c"># chkconfig mysqld on</span></code></pre></figure>

<h2 id="mysql-connector-installation">MySQL connector Installation</h2>

<p>Install Python MySQL connector using the official MySQL packages repository.
Create the file <code class="highlighter-rouge">/etc/yum.repos.d/mysql.repo</code> with the following content:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="o">[</span>mysql-connectors-community]
   <span class="nv">name</span><span class="o">=</span>MySQL Community connectors
   <span class="nv">baseurl</span><span class="o">=</span>http://repo.mysql.com/yum/mysql-connectors-community/el/<span class="nv">$releasever</span>/<span class="nv">$basearch</span>/
   <span class="nv">enabled</span><span class="o">=</span>1
   <span class="nv">gpgcheck</span><span class="o">=</span>1</code></pre></figure>

<p>Import GPG public key from MySQL:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   rpm --import http://repo.mysql.com/RPM-GPG-KEY-mysql</code></pre></figure>

<p>Install mysql-connector</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   yum install mysql-connector-python</code></pre></figure>

<h2 id="installation">Installation</h2>

<p>We are now going to install the management server. We do that by executing the 
following command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="c"># yum -y install cloudstack-management</span></code></pre></figure>

<p>With the application itself installed we can now setup the database, we’ll do 
that with the following command and options:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="c"># cloudstack-setup-databases cloud:password@localhost --deploy-as=root</span></code></pre></figure>

<p>When this process is finished, you should see a message like “CloudStack has 
successfully initialized the database.”</p>

<p>Now that the database has been created, we can take the final step in setting 
up the management server by issuing the following command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   <span class="c"># cloudstack-setup-management</span></code></pre></figure>

<p>If the servlet container is Tomcat7 the argument –tomcat7 must be used.</p>

<h2 id="system-template-setup">System Template Setup</h2>

<p>CloudStack uses a number of system VMs to provide functionality for accessing 
the console of virtual machines, providing various networking services, and 
managing various aspects of storage. This step will acquire those system 
images ready for deployment when we bootstrap your cloud.</p>

<p>Now we need to download the system VM template and deploy that to the share we 
just mounted. The management server includes a script to properly manipulate 
the system VMs images.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">   /usr/share/cloudstack-common/scripts/storage/secondary/cloud-install-sys-tmplt <span class="se">\</span>
   -m /export/secondary <span class="se">\</span>
   -u http://cloudstack.apt-get.eu/systemvm/4.6/systemvm64template-4.6.0-kvm.qcow2.bz2 <span class="se">\</span>
   -h kvm -F</code></pre></figure>

<p>That concludes our setup of the management server. We still need to configure 
CloudStack, but we will do that after we get our hypervisor set up.</p>

<h1 id="kvm-setup-and-installation">KVM Setup and Installation</h1>

<p>KVM is the hypervisor we’ll be using - we will recover the initial setup which 
has already been done on the hypervisor host and cover installation of the 
agent software, you can use the same steps to add additional KVM nodes to your 
CloudStack environment.</p>

<h2 id="prerequisites-1">Prerequisites</h2>

<p>We explicitly are using the management server as a compute node as well, which 
means that we have already performed many of the prerequisite steps when 
setting up the management server, but we will list them here for clarity. 
Those steps are:</p>

<p>#. :ref:<code class="highlighter-rouge">conf-network</code></p>

<p>#. :ref:<code class="highlighter-rouge">conf-hostname</code></p>

<p>#. :ref:<code class="highlighter-rouge">conf-selinux</code></p>

<p>#. :ref:<code class="highlighter-rouge">conf-ntp</code></p>

<p>#. :ref:<code class="highlighter-rouge">qigconf-pkg-repo</code></p>

<p>You shouldn’t need to do that for the management server, of course, but any 
additional hosts will need for you to complete the above steps.</p>

<h1 id="installation-1">Installation</h1>

<p>Installation of the KVM agent is trivial with just a single command, but 
afterwards we’ll need to configure a few things.</p>

<p>.. sourcecode:: bash</p>

<p># yum -y install cloudstack-agent</p>

<h2 id="kvm-configuration">KVM Configuration</h2>

<p>We have two different parts of KVM to configure, libvirt, and QEMU.</p>

<h2 id="qemu-configuration">QEMU Configuration</h2>

<p>KVM configuration is relatively simple at only a single item. We need to edit 
the QEMU VNC configuration. This is done by editing /etc/libvirt/qemu.conf and 
ensuring the following line is present and uncommented.</p>

<p>::</p>

<p>vnc_listen=0.0.0.0</p>

<h2 id="libvirt-configuration">Libvirt Configuration</h2>

<p>CloudStack uses libvirt for managing virtual machines. Therefore it is vital 
that libvirt is configured correctly. Libvirt is a dependency of cloud-agent 
and should already be installed.</p>

<p>#. In order to have live migration working libvirt has to listen for unsecured 
   TCP connections. We also need to turn off libvirts attempt to use Multicast 
   DNS advertising. Both of these settings are in /etc/libvirt/libvirtd.conf</p>

<p>Set the following paramaters:</p>

<p>::</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  listen_tls = 0
  listen_tcp = 1
  tcp_port = "16059"
  auth_tcp = "none"
  mdns_adv = 0
</code></pre>
</div>

<p>#. Turning on “listen_tcp” in libvirtd.conf is not enough, we have to change 
   the parameters as well we also need to modify /etc/sysconfig/libvirtd:</p>

<p>Uncomment the following line:</p>

<p>::</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  #LIBVIRTD_ARGS="--listen"
</code></pre>
</div>

<p>#. Restart libvirt</p>

<p>.. sourcecode:: bash</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  # service libvirtd restart
</code></pre>
</div>

<h2 id="kvm-configuration-complete">KVM configuration complete</h2>

<p>For the sake of completeness you should check if KVM is running OK on your machine:
   .. sourcecode:: bash</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  # lsmod | grep kvm
  kvm_intel              55496  0
  kvm                   337772  1 kvm_intel
</code></pre>
</div>

<p>That concludes our installation and configuration of KVM, and we’ll now move 
to using the CloudStack UI for the actual configuration of our cloud.</p>

<h1 id="configuration">Configuration</h1>

<p>As we noted before we will be using security groups to provide isolation and 
by default that implies that we’ll be using a flat layer-2 network. It also 
means that the simplicity of our setup means that we can use the quick 
installer.</p>

<h2 id="ui-access">UI Access</h2>

<p>To get access to CloudStack’s web interface, merely point your browser to 
http://172.16.10.2:8080/client The default username is ‘admin’, and the 
default password is ‘password’. You should see a splash screen that allows you 
to choose several options for setting up CloudStack. You should choose the 
Continue with Basic Setup option.</p>

<p>You should now see a prompt requiring you to change the password for the admin 
user. Please do so.</p>

<h2 id="setting-up-a-zone">Setting up a Zone</h2>

<p>A zone is the largest organization entity in CloudStack - and we’ll be 
creating one, this should be the screen that you see in front of you now. And 
for us there are 5 pieces of information that we need.</p>

<p>#. Name - we will set this to the ever-descriptive ‘Zone1’ for our cloud.</p>

<p>#. Public DNS 1 - we will set this to <code class="highlighter-rouge">8.8.8.8</code> for our cloud.</p>

<p>#. Public DNS 2 - we will set this to <code class="highlighter-rouge">8.8.4.4</code> for our cloud.</p>

<p>#. Internal DNS1 - we will also set this to <code class="highlighter-rouge">8.8.8.8</code> for our cloud.</p>

<p>#. Internal DNS2 - we will also set this to <code class="highlighter-rouge">8.8.4.4</code> for our cloud.</p>

<p>.. note:: 
   CloudStack distinguishes between internal and public DNS. Internal DNS is 
   assumed to be capable of resolving internal-only hostnames, such as your 
   NFS server’s DNS name. Public DNS is provided to the guest VMs to resolve 
   public IP addresses. You can enter the same DNS server for both types, but 
   if you do so, you must make sure that both internal and public IP addresses 
   can route to the DNS server. In our specific case we will not use any names 
   for resources internally, and we have indeed them set to look to the same 
   external resource so as to not add a namerserver setup to our list of 
   requirements.</p>

<h2 id="pod-configuration">Pod Configuration</h2>

<p>Now that we’ve added a Zone, the next step that comes up is a prompt for 
information regading a pod. Which is looking for several items.</p>

<p>#. Name - We’ll use <code class="highlighter-rouge">Pod1</code> for our cloud.</p>

<p>#. Gateway - We’ll use <code class="highlighter-rouge">172.16.10.1</code> as our gateway</p>

<p>#. Netmask - We’ll use <code class="highlighter-rouge">255.255.255.0</code></p>

<p>#. Start/end reserved system IPs - we will use <code class="highlighter-rouge">172.16.10.10-172.16.10.20</code></p>

<p>#. Guest gateway - We’ll use <code class="highlighter-rouge">172.16.10.1</code></p>

<p>#. Guest netmask - We’ll use <code class="highlighter-rouge">255.255.255.0</code></p>

<p>#. Guest start/end IP - We’ll use <code class="highlighter-rouge">172.16.10.30-172.16.10.200</code></p>

<h2 id="cluster">Cluster</h2>

<p>Now that we’ve added a Zone, we need only add a few more items for configuring 
the cluster.</p>

<p>#. Name - We’ll use <code class="highlighter-rouge">Cluster1</code></p>

<p>#. Hypervisor - Choose <code class="highlighter-rouge">KVM</code></p>

<p>You should be prompted to add the first host to your cluster at this point. 
Only a few bits of information are needed.</p>

<p>#. Hostname - we’ll use the IP address <code class="highlighter-rouge">172.16.10.2</code> since we didn’t set up a 
   DNS server.</p>

<p>#. Username - we’ll use <code class="highlighter-rouge">root</code></p>

<p>#. Password - enter the operating system password for the root user</p>

<h2 id="primary-storage">Primary Storage</h2>

<p>With your cluster now setup - you should be prompted for primary storage 
information. Choose NFS as the storage type and then enter the following 
values in the fields:</p>

<p>#. Name - We’ll use <code class="highlighter-rouge">Primary1</code></p>

<p>#. Server - We’ll be using the IP address <code class="highlighter-rouge">172.16.10.2</code></p>

<p>#. Path - Well define <code class="highlighter-rouge">/export/primary</code> as the path we are using</p>

<h2 id="secondary-storage">Secondary Storage</h2>

<p>If this is a new zone, you’ll be prompted for secondary storage information - 
populate it as follows:</p>

<p>#. NFS server - We’ll use the IP address <code class="highlighter-rouge">172.16.10.2</code></p>

<p>#. Path - We’ll use <code class="highlighter-rouge">/export/secondary</code></p>

<p>Now, click Launch and your cloud should begin setup - it may take several 
minutes depending on your internet connection speed for setup to finalize.</p>

<p>That’s it, you are done with installation of your Apache CloudStack cloud.</p>


        </div>

    </div>
</div>


        <!-- /#page-content-wrapper -->


    </div>
    <!-- /#wrapper -->

    <footer class="site-footer">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <p class="text-muted">Copyright © 2016 The Apache Software Foundation, Licensed under the Apache License, Version 2.0. <BR>"Apache", "CloudStack", "Apache CloudStack", the Apache CloudStack logo, the Apache CloudStack Cloud Monkey logo and the Apache feather logos are registered trademarks or trademarks of The Apache Software Foundation.<BR> <A href="http://cloudstack.apache.org/trademark-guidelines.html">Apache CloudStack Trademark Usage</a> - <A href="http://cloudstack.apache.org/bylaws.html">Apache CloudStack Community ByLaws</A></p>
                </div>
            </div>
        </div>
    </footer>


    <!-- JavaScript -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.1/anchor.min.js"></script>
    <script src="/js/power.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/toc.js"></script>
   <!-- Menu Toggle Script -->
    <script>
        $("#menu-toggle").click(function(e) {
                e.preventDefault();
                $("#wrapper").toggleClass("active");
        });
    </script>

    <script type="text/javascript">
    $(function() {
      $('#main').toc({
        showAlways:true,
        renderIn:'#renderIn',
        contentsText:"Table of Contents",
        hideText:'Collapse',
        showText:'Expand',
        showCollapsed:false
      });
    });
    </script>

    </body>
</html>